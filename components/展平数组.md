要将多层嵌套的children结构展平为一个数组，可以使用递归或lodash的`flattenDeep`配合映射来实现。以下是两种常用方法：

### 方法一：原生JavaScript递归实现
通过递归遍历每一层的children，将所有节点收集到一个数组中：

```javascript
function flattenChildren(nodes) {
  // 确保输入是数组，如果是单个节点则转为数组处理
  const arr = Array.isArray(nodes) ? nodes : [nodes];
  let result = [];
  
  arr.forEach(node => {
    // 将当前节点添加到结果中
    result.push(node);
    
    // 如果有children，递归处理并合并结果
    if (node.children && node.children.length) {
      result = result.concat(flattenChildren(node.children));
    }
  });
  
  return result;
}

// 示例数据
const data = {
  id: 1,
  children: [
    {
      id: 2,
      children: [
        {
          id: 3,
          children: [
            { id: 4 } // 第四层
          ]
        }
      ]
    }
  ]
};

// 使用方法
const flattened = flattenChildren(data);
console.log(flattened); // 包含id为1,2,3,4的所有节点
```

### 方法二：使用lodash实现
lodash的`flattenDeep`可以直接展平数组，结合`map`递归处理children：

```javascript
import _ from 'lodash';

function flattenWithLodash(node) {
  // 处理单个节点的情况
  const nodes = Array.isArray(node) ? node : [node];
  
  // 递归映射所有节点及其children
  const mapped = nodes.map(item => {
    return [item, ...(item.children ? flattenWithLodash(item.children) : [])];
  });
  
  // 展平为一维数组
  return _.flattenDeep(mapped);
}

// 示例使用
const flattened = flattenWithLodash(data);
console.log(flattened);
```

### 方法三：更简洁的lodash链式调用
```javascript
import _ from 'lodash';

const flatten = (nodes) => {
  return _.chain(nodes)
    .castArray() // 确保是数组
    .flatMap(node => [node, ...(node.children ? flatten(node.children) : [])])
    .value();
};
```

### 关键逻辑说明：
1. 无论是原生实现还是lodash方法，核心都是**递归遍历**每一层的children
2. 每次处理时都会：
   - 将当前节点添加到结果中
   - 检查是否有children，如有则递归处理
3. 最终会将所有层级的节点合并为一个一维数组

这些方法适用于任意层级的嵌套结构（不限于4层），会按照节点在嵌套中的顺序依次排列在结果数组中。
