<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>豆包风格对话</title>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    // 模拟后端API服务
    const mockApiService = {
      // 创建对话会话
      createSession: function(question) {
        return new Promise(resolve => {
          setTimeout(() => {
            resolve({
              sessionId: 'sess_' + Date.now(),
              status: 'active'
            });
          }, 600);
        });
      },
      
      // 获取思考过程（逐字）
      getThinkingStream: function(sessionId, question, currentLength) {
        return new Promise(resolve => {
          // 根据问题生成思考内容
          let thinkingContent = "";
          
          if (question.includes("人工智能")) {
            thinkingContent = "用户现在问什么是人工智能，我需要先给出一个简洁的定义。然后应该举几个日常生活中的例子，让解释更易懂。还要提到它的主要应用领域，比如语音助手、图像识别这些。需要注意避免使用太专业的术语，保持口语化。最后可以简单提一下发展现状，让回答更完整。";
          } else if (question.includes("推荐") && question.includes("书")) {
            thinkingContent = "用户想让我推荐一本书，首先得考虑不同类型的可能性。可能是小说，也可能是非虚构类。需要选一本比较经典且受众广的。《百年孤独》怎么样？它是魔幻现实主义的代表作，很多人都喜欢。应该简单介绍一下这本书的特点和为什么值得一读，让推荐更有说服力。";
          } else if (question.includes("学习") && question.includes("编程")) {
            thinkingContent = "用户想知道如何学习编程，首先应该建议从简单的语言开始，比如Python。然后需要推荐一些学习资源，在线课程和书籍都可以。最重要的是强调实践的重要性，多做项目才能真正掌握。还可以建议加入社区，方便解决问题和交流经验。要有一个清晰的步骤，让用户知道从哪里入手。";
          } else {
            thinkingContent = "我来看看这个问题，用户问的是" + question + "。首先需要理解用户的真实需求是什么，他们想知道的核心点在哪里。然后应该组织一下思路，从几个方面来回答比较好。要确保信息准确，同时语言要通俗易懂。检查一下有没有遗漏的重要信息，确保回答全面且有帮助。";
          }
          
          // 控制每次返回的字符数（模拟逐字思考）
          const charsPerStep = 1;
          const start = currentLength;
          const end = Math.min(start + charsPerStep, thinkingContent.length);
          const chunk = thinkingContent.substring(start, end);
          
          setTimeout(() => {
            resolve({
              chunk: chunk,
              isComplete: end >= thinkingContent.length,
              sessionId: sessionId
            });
          }, 50); // 每50ms返回一个字符，控制思考速度
        });
      },
      
      // 获取最终回答
      getFinalAnswer: function(sessionId, question) {
        return new Promise(resolve => {
          setTimeout(() => {
            let answer = "";
            
            if (question.includes("人工智能")) {
              answer = "人工智能（AI）是一种能够模拟人类智能的技术，它让计算机可以像人一样思考、学习和解决问题。<br><br>生活中常见的例子有：手机上的语音助手（如Siri、小爱同学）、人脸识别解锁、电商平台的商品推荐等。<br><br>目前AI已广泛应用在医疗、教育、交通等领域，比如辅助医生诊断疾病、智能教学系统、自动驾驶技术等。随着技术发展，AI会在更多方面帮助我们提高效率、改善生活。";
            } else if (question.includes("推荐") && question.includes("书")) {
              answer = "我推荐加西亚·马尔克斯的《百年孤独》。<br><br>这是一部魔幻现实主义的经典之作，讲述了布恩迪亚家族七代人的传奇故事。书中将奇幻元素与现实生活完美融合，探讨了爱情、孤独、时间等永恒主题。<br><br>它的叙事风格独特，想象力丰富，不仅是诺贝尔文学奖获奖作品，还被翻译成多种语言，影响了全球无数读者和作家。如果你喜欢有深度、有想象力的文学作品，这本书值得一读。";
            } else if (question.includes("学习") && question.includes("编程")) {
              answer = "学习编程可以按以下步骤进行：<br><br>1. 选择入门语言：推荐Python，语法简洁易懂，应用广泛；<br>2. 系统学习基础：通过在线课程（如Coursera、慕课网）或入门书籍打基础；<br>3. 多做实践项目：从简单的小程序（如计算器）开始，逐步挑战复杂项目；<br>4. 加入学习社区：如Stack Overflow、GitHub，遇到问题多请教交流；<br>5. 坚持练习：编程是技能，每天练习才能熟练掌握。<br><br>关键是保持好奇心，遇到问题不放弃，逐步积累经验。";
            } else {
              answer = `关于"${question}"，我的理解是：<br><br>这是一个很有价值的问题，涉及到多个方面。从基础层面来说，它关乎我们对事物的认知和理解。<br><br>具体来看，可以从不同角度分析：首先是核心本质，其次是实际应用，最后是可能的发展。<br><br>希望这个回答能帮到你，如果你有更具体的需求，可以补充说明，我会进一步解答。`;
            }
            
            resolve({
              answer: answer,
              sessionId: sessionId
            });
          }, 800);
        });
      }
    };
  </script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }
    
    body {
      background-color: #f7f8fa;
      color: #333;
      line-height: 1.6;
    }
    
    .container {
      max-width: 700px;
      margin: 0 auto;
      padding: 20px 15px;
    }
    
    header {
      text-align: center;
      padding: 15px 0;
      border-bottom: 1px solid #eee;
      margin-bottom: 20px;
    }
    
    .logo {
      font-size: 24px;
      font-weight: 600;
      color: #1677ff;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .chat-box {
      background-color: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      padding: 20px;
      min-height: 500px;
      margin-bottom: 20px;
      overflow-y: auto;
    }
    
    .message {
      margin-bottom: 20px;
      max-width: 85%;
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .user-message {
      margin-left: auto;
    }
    
    .ai-message {
      margin-right: auto;
    }
    
    .message-content {
      padding: 12px 16px;
      border-radius: 10px;
      position: relative;
    }
    
    .user-content {
      background-color: #1677ff;
      color: white;
      border-top-right-radius: 4px;
    }
    
    .ai-content {
      background-color: #f1f5f9;
      color: #334155;
      border-top-left-radius: 4px;
    }
    
    .thinking-container {
      background-color: #f8fafc;
      padding: 12px 16px;
      border-radius: 10px;
      border-top-left-radius: 4px;
      margin-bottom: 10px;
      font-size: 14px;
      color: #64748b;
      border-left: 3px solid #94a3b8;
    }
    
    .thinking-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      font-weight: 500;
    }
    
    .typing-indicator {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      margin-top: 5px;
    }
    
    .typing-indicator span {
      width: 6px;
      height: 6px;
      background-color: #94a3b8;
      border-radius: 50%;
      animation: typing 1.4s infinite ease-in-out both;
    }
    
    .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
    .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
    
    @keyframes typing {
      0% { transform: translateY(0); }
      28% { transform: translateY(-5px); }
      44% { transform: translateY(0); }
    }
    
    .input-area {
      position: relative;
    }
    
    textarea {
      width: 100%;
      padding: 14px 16px;
      border: 1px solid #e2e8f0;
      border-radius: 10px;
      resize: none;
      font-size: 16px;
      min-height: 50px;
      max-height: 150px;
      transition: all 0.2s;
    }
    
    textarea:focus {
      outline: none;
      border-color: #1677ff;
      box-shadow: 0 0 0 2px rgba(22, 119, 255, 0.1);
    }
    
    .send-btn {
      position: absolute;
      right: 12px;
      bottom: 12px;
      background-color: #1677ff;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: background-color 0.2s;
    }
    
    .send-btn:hover {
      background-color: #0f62d9;
    }
    
    .send-btn:disabled {
      background-color: #94a3b8;
      cursor: not-allowed;
    }
    
    .toggle-thinking {
      background: none;
      border: none;
      color: #1677ff;
      font-size: 13px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      margin-top: 5px;
      padding: 2px 0;
    }
    
    .toggle-thinking:hover {
      text-decoration: underline;
    }
    
    .suggestions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }
    
    .suggestion-btn {
      background-color: #f1f5f9;
      border: 1px solid #e2e8f0;
      border-radius: 20px;
      padding: 6px 14px;
      font-size: 14px;
      color: #334155;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .suggestion-btn:hover {
      background-color: #e2e8f0;
    }
  </style>
</head>
<body>
  <div class="container" id="app">
    <header>
      <div class="logo">
        <i class="fa fa-comments-o"></i>
        <span>豆包风格对话</span>
      </div>
    </header>
    
    <div class="chat-box" id="chatBox">
      <div v-for="(msg, index) in messages" :key="index" :class="['message', msg.isUser ? 'user-message' : 'ai-message']">
        <div v-if="msg.isUser">
          <div class="message-content user-content">
            {{ msg.content }}
          </div>
        </div>
        
        <div v-else>
          <div v-if="msg.showThinking" class="thinking-container">
            <div class="thinking-header">
              <i class="fa fa-lightbulb-o"></i>
              <span>思考过程</span>
            </div>
            <div>{{ msg.thinkingText }}</div>
            <div class="typing-indicator" v-if="msg.isThinking">
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>
          
          <button class="toggle-thinking" v-if="!msg.isThinking" @click="msg.showThinking = !msg.showThinking">
            <i class="fa" :class="msg.showThinking ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
            <span>{{ msg.showThinking ? '隐藏思考过程' : '显示思考过程' }}</span>
          </button>
          
          <div class="message-content ai-content" v-html="msg.content"></div>
        </div>
      </div>
      
      <div class="suggestions" v-if="messages.length === 0">
        <button class="suggestion-btn" @click="useSuggestion('什么是人工智能？')">什么是人工智能？</button>
        <button class="suggestion-btn" @click="useSuggestion('推荐一本好书')">推荐一本好书</button>
        <button class="suggestion-btn" @click="useSuggestion('如何学习编程？')">如何学习编程？</button>
      </div>
    </div>
    
    <div class="input-area">
      <textarea 
        v-model="userInput" 
        placeholder="请输入你的问题..."
        @keydown.enter.exact="sendMessage"
        @keydown.enter.shift="addNewline"
        :disabled="isLoading"
      ></textarea>
      <button class="send-btn" @click="sendMessage" :disabled="isLoading || !userInput.trim()">
        <i class="fa fa-paper-plane"></i>
        <span>发送</span>
      </button>
    </div>
  </div>

  <script>
    new Vue({
      el: '#app',
      data() {
        return {
          userInput: '',
          messages: [],
          isLoading: false,
          currentSessionId: null,
          thinkingInterval: null
        };
      },
      methods: {
        sendMessage() {
          if (!this.userInput.trim() || this.isLoading) return;
          
          const userMessage = this.userInput.trim();
          
          // 添加用户消息
          this.messages.push({
            isUser: true,
            content: userMessage
          });
          
          // 添加AI消息占位符
          const aiMessageIndex = this.messages.push({
            isUser: false,
            content: '',
            thinkingText: '',
            isThinking: true,
            showThinking: true
          }) - 1;
          
          this.userInput = '';
          this.isLoading = true;
          this.scrollToBottom();
          
          // 模拟真实请求流程
          this.processRequest(userMessage, aiMessageIndex);
        },
        
        async processRequest(question, aiMessageIndex) {
          try {
            // 1. 创建会话（模拟真实API调用）
            const session = await mockApiService.createSession(question);
            this.currentSessionId = session.sessionId;
            
            // 2. 获取思考过程（逐字展示）
            await this.getThinkingProcess(session.sessionId, question, aiMessageIndex);
            
            // 3. 获取最终回答
            const answerResponse = await mockApiService.getFinalAnswer(session.sessionId, question);
            this.messages[aiMessageIndex].content = answerResponse.answer;
            this.messages[aiMessageIndex].isThinking = false;
          } catch (error) {
            console.error('请求错误:', error);
            this.messages[aiMessageIndex].content = '抱歉，处理请求时出错，请重试。';
            this.messages[aiMessageIndex].isThinking = false;
          } finally {
            this.isLoading = false;
            this.scrollToBottom();
          }
        },
        
        // 逐字获取并展示思考内容
        getThinkingProcess(sessionId, question, aiMessageIndex) {
          return new Promise(resolve => {
            const fetchNextChar = async () => {
              // 检查是否为当前会话（防止多个请求冲突）
              if (this.currentSessionId !== sessionId) {
                resolve();
                return;
              }
              
              const currentLength = this.messages[aiMessageIndex].thinkingText.length;
              const response = await mockApiService.getThinkingStream(sessionId, question, currentLength);
              
              // 添加新字符
              this.messages[aiMessageIndex].thinkingText += response.chunk;
              this.scrollToBottom();
              
              if (response.isComplete) {
                // 思考完成
                resolve();
              } else {
                // 继续获取下一个字符
                fetchNextChar();
              }
            };
            
            // 开始获取思考内容
            fetchNextChar();
          });
        },
        
        addNewline() {
          this.userInput += '\n';
          this.$forceUpdate();
        },
        
        useSuggestion(text) {
          this.userInput = text;
        },
        
        scrollToBottom() {
          this.$nextTick(() => {
            const chatBox = document.getElementById('chatBox');
            chatBox.scrollTop = chatBox.scrollHeight;
          });
        }
      }
    });
  </script>
</body>
</html>
